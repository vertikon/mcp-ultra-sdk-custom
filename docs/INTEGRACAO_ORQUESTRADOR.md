# üîå Integra√ß√£o com MCP-ULTRA-ORQUESTRADOR

**Vers√£o:** 1.0.0
**Status:** üìã ESPECIFICA√á√ÉO (Orquestrador em desenvolvimento)
**SDK Version:** v9.0.0

---

## üìã Vis√£o Geral

Este documento especifica como o **mcp-ultra-sdk-custom v9** se integrar√° com o **MCP-ULTRA-ORQUESTRADOR** quando este estiver pronto.

**Funcionalidades Planejadas:**
- üîÑ Sincroniza√ß√£o autom√°tica de seeds e templates
- üìä Auditoria de vers√£o entre SDK e Template
- üîç Controle de compatibilidade vertical via MCP-Version-Matrix

---

## üèóÔ∏è Arquitetura de Integra√ß√£o

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  MCP-ULTRA-ORQUESTRADOR                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  Orchestration Engine                                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Seed Sync Manager                                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Version Auditor                                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Compatibility Matrix                                  ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                    ‚îÇ                                            ‚îÇ
‚îÇ                    ‚îÇ NATS Messages                              ‚îÇ
‚îÇ                    ‚îÇ                                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                         ‚îÇ
        ‚Üì                         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  MCP-ULTRA-SDK   ‚îÇ    ‚îÇ   SEED-WABA      ‚îÇ
‚îÇ   (este m√≥dulo)  ‚îÇ    ‚îÇ  (seed example)  ‚îÇ
‚îÇ                  ‚îÇ    ‚îÇ                  ‚îÇ
‚îÇ  - Contracts     ‚îÇ    ‚îÇ  - Plugin WABA   ‚îÇ
‚îÇ  - Registry      ‚îÇ    ‚îÇ  - Templates     ‚îÇ
‚îÇ  - Bootstrap     ‚îÇ    ‚îÇ  - Handlers      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîÑ 1. Sincroniza√ß√£o Autom√°tica de Seeds e Templates

### 1.1 NATS Subjects para Sync

| Subject | Tipo | Descri√ß√£o |
|---------|------|-----------|
| `mcp.orchestrator.sync.request` | Request/Reply | Solicita sincroniza√ß√£o |
| `mcp.orchestrator.sync.seed.{name}` | Pub/Sub | Atualiza√ß√£o de seed |
| `mcp.orchestrator.sync.template.{name}` | Pub/Sub | Atualiza√ß√£o de template |
| `mcp.orchestrator.sync.status` | Pub/Sub | Status de sincroniza√ß√£o |

### 1.2 Contrato: Sync Request

**Subject:** `mcp.orchestrator.sync.request`

**Request:**
```json
{
  "sdk_version": "v9.0.0",
  "module": "github.com/vertikon/mcp-ultra-sdk-custom",
  "seeds": ["waba", "marketing"],
  "timestamp": "2025-10-05T21:10:00Z",
  "requester": "sdk-instance-01"
}
```

**Response:**
```json
{
  "sync_id": "sync-20251005-211000",
  "status": "initiated",
  "seeds_to_update": [
    {
      "name": "waba",
      "current_version": "1.0.0",
      "latest_version": "1.1.0",
      "update_required": true
    },
    {
      "name": "marketing",
      "current_version": "1.0.0",
      "latest_version": "1.0.0",
      "update_required": false
    }
  ],
  "template_updates": [
    {
      "name": "mcp-ultra-base",
      "current_version": "2.0.0",
      "latest_version": "2.1.0",
      "breaking_changes": false
    }
  ],
  "estimated_duration": "30s",
  "timestamp": "2025-10-05T21:10:01Z"
}
```

### 1.3 Contrato: Seed Update

**Subject:** `mcp.orchestrator.sync.seed.{name}`

**Message:**
```json
{
  "seed_name": "waba",
  "version": "1.1.0",
  "changelog": [
    "feat: add message template validation",
    "fix: HMAC signature verification"
  ],
  "files_updated": [
    "internal/plugins/waba/plugin.go",
    "internal/plugins/waba/templates.go"
  ],
  "migration_required": false,
  "download_url": "https://registry.vertikon.internal/seeds/waba-1.1.0.tar.gz",
  "checksum_sha256": "abc123...",
  "timestamp": "2025-10-05T21:10:05Z"
}
```

### 1.4 Implementa√ß√£o no SDK (Preparada)

**Arquivo:** `pkg/orchestrator/sync.go` (a ser criado quando orquestrador estiver pronto)

```go
package orchestrator

import (
    "context"
    "encoding/json"
    "time"

    "github.com/nats-io/nats.go"
)

// SyncRequest representa uma solicita√ß√£o de sincroniza√ß√£o
type SyncRequest struct {
    SDKVersion  string    `json:"sdk_version"`
    Module      string    `json:"module"`
    Seeds       []string  `json:"seeds"`
    Timestamp   time.Time `json:"timestamp"`
    Requester   string    `json:"requester"`
}

// SyncResponse representa a resposta de sincroniza√ß√£o
type SyncResponse struct {
    SyncID            string          `json:"sync_id"`
    Status            string          `json:"status"`
    SeedsToUpdate     []SeedUpdate    `json:"seeds_to_update"`
    TemplateUpdates   []TemplateUpdate `json:"template_updates"`
    EstimatedDuration string          `json:"estimated_duration"`
    Timestamp         time.Time       `json:"timestamp"`
}

// SyncManager gerencia sincroniza√ß√µes com o orquestrador
type SyncManager struct {
    nc         *nats.Conn
    sdkVersion string
    module     string
}

// NewSyncManager cria um novo gerenciador de sincroniza√ß√£o
func NewSyncManager(nc *nats.Conn, sdkVersion, module string) *SyncManager {
    return &SyncManager{
        nc:         nc,
        sdkVersion: sdkVersion,
        module:     module,
    }
}

// RequestSync solicita sincroniza√ß√£o ao orquestrador
func (sm *SyncManager) RequestSync(ctx context.Context, seeds []string) (*SyncResponse, error) {
    req := SyncRequest{
        SDKVersion: sm.sdkVersion,
        Module:     sm.module,
        Seeds:      seeds,
        Timestamp:  time.Now(),
        Requester:  "sdk-instance", // TODO: get from config
    }

    reqData, err := json.Marshal(req)
    if err != nil {
        return nil, err
    }

    msg, err := sm.nc.RequestWithContext(ctx, "mcp.orchestrator.sync.request", reqData)
    if err != nil {
        return nil, err
    }

    var resp SyncResponse
    if err := json.Unmarshal(msg.Data, &resp); err != nil {
        return nil, err
    }

    return &resp, nil
}

// SubscribeSeedUpdates assina atualiza√ß√µes de seeds
func (sm *SyncManager) SubscribeSeedUpdates(handler func(*SeedUpdate)) error {
    _, err := sm.nc.Subscribe("mcp.orchestrator.sync.seed.*", func(msg *nats.Msg) {
        var update SeedUpdate
        if err := json.Unmarshal(msg.Data, &update); err != nil {
            // Log error
            return
        }
        handler(&update)
    })
    return err
}
```

---

## üìä 2. Auditoria de Vers√£o entre SDK e Template

### 2.1 NATS Subjects para Auditoria

| Subject | Tipo | Descri√ß√£o |
|---------|------|-----------|
| `mcp.orchestrator.audit.version.request` | Request/Reply | Solicita auditoria |
| `mcp.orchestrator.audit.version.report` | Pub/Sub | Relat√≥rio de auditoria |
| `mcp.orchestrator.audit.version.alert` | Pub/Sub | Alerta de incompatibilidade |

### 2.2 Contrato: Audit Request

**Subject:** `mcp.orchestrator.audit.version.request`

**Request:**
```json
{
  "sdk_version": "v9.0.0",
  "sdk_module": "github.com/vertikon/mcp-ultra-sdk-custom",
  "seeds": [
    {
      "name": "waba",
      "version": "1.0.0",
      "sdk_dependency": "v9.0.0"
    }
  ],
  "timestamp": "2025-10-05T21:10:00Z"
}
```

**Response:**
```json
{
  "audit_id": "audit-20251005-211000",
  "status": "completed",
  "sdk_version": "v9.0.0",
  "compatibility_score": 100,
  "issues": [],
  "recommendations": [],
  "audit_details": {
    "seeds_audited": 1,
    "templates_audited": 1,
    "version_mismatches": 0,
    "deprecated_features": 0
  },
  "timestamp": "2025-10-05T21:10:02Z"
}
```

### 2.3 Contrato: Version Report

**Subject:** `mcp.orchestrator.audit.version.report`

**Message:**
```json
{
  "report_id": "report-20251005-211000",
  "sdk_version": "v9.0.0",
  "template_version": "2.0.0",
  "compatibility_matrix": {
    "sdk_to_template": "COMPATIBLE",
    "template_to_seeds": "COMPATIBLE",
    "seeds_to_sdk": "COMPATIBLE"
  },
  "version_graph": {
    "mcp-ultra-sdk-custom": {
      "version": "v9.0.0",
      "dependencies": {
        "mcp-ultra-template": ">=2.0.0"
      }
    },
    "seed-waba": {
      "version": "1.0.0",
      "dependencies": {
        "mcp-ultra-sdk-custom": ">=v9.0.0"
      }
    }
  },
  "warnings": [],
  "errors": [],
  "timestamp": "2025-10-05T21:10:02Z"
}
```

### 2.4 Implementa√ß√£o no SDK (Preparada)

**Arquivo:** `pkg/orchestrator/audit.go` (a ser criado)

```go
package orchestrator

import (
    "context"
    "encoding/json"
    "time"

    "github.com/nats-io/nats.go"
)

// AuditRequest representa uma solicita√ß√£o de auditoria
type AuditRequest struct {
    SDKVersion string        `json:"sdk_version"`
    SDKModule  string        `json:"sdk_module"`
    Seeds      []SeedVersion `json:"seeds"`
    Timestamp  time.Time     `json:"timestamp"`
}

// AuditResponse representa a resposta de auditoria
type AuditResponse struct {
    AuditID           string       `json:"audit_id"`
    Status            string       `json:"status"`
    SDKVersion        string       `json:"sdk_version"`
    CompatibilityScore int         `json:"compatibility_score"`
    Issues            []AuditIssue `json:"issues"`
    Recommendations   []string     `json:"recommendations"`
    AuditDetails      AuditDetails `json:"audit_details"`
    Timestamp         time.Time    `json:"timestamp"`
}

// AuditManager gerencia auditorias de vers√£o
type AuditManager struct {
    nc         *nats.Conn
    sdkVersion string
    module     string
}

// NewAuditManager cria um novo gerenciador de auditoria
func NewAuditManager(nc *nats.Conn, sdkVersion, module string) *AuditManager {
    return &AuditManager{
        nc:         nc,
        sdkVersion: sdkVersion,
        module:     module,
    }
}

// RequestAudit solicita auditoria de vers√£o
func (am *AuditManager) RequestAudit(ctx context.Context, seeds []SeedVersion) (*AuditResponse, error) {
    req := AuditRequest{
        SDKVersion: am.sdkVersion,
        SDKModule:  am.module,
        Seeds:      seeds,
        Timestamp:  time.Now(),
    }

    reqData, err := json.Marshal(req)
    if err != nil {
        return nil, err
    }

    msg, err := am.nc.RequestWithContext(ctx, "mcp.orchestrator.audit.version.request", reqData)
    if err != nil {
        return nil, err
    }

    var resp AuditResponse
    if err := json.Unmarshal(msg.Data, &resp); err != nil {
        return nil, err
    }

    return &resp, nil
}

// SubscribeAuditReports assina relat√≥rios de auditoria
func (am *AuditManager) SubscribeAuditReports(handler func(*VersionReport)) error {
    _, err := am.nc.Subscribe("mcp.orchestrator.audit.version.report", func(msg *nats.Msg) {
        var report VersionReport
        if err := json.Unmarshal(msg.Data, &report); err != nil {
            // Log error
            return
        }
        handler(&report)
    })
    return err
}
```

---

## üîç 3. Controle de Compatibilidade via MCP-Version-Matrix

### 3.1 NATS Subjects para Version Matrix

| Subject | Tipo | Descri√ß√£o |
|---------|------|-----------|
| `mcp.orchestrator.matrix.query` | Request/Reply | Consulta matriz |
| `mcp.orchestrator.matrix.update` | Pub/Sub | Atualiza√ß√£o da matriz |
| `mcp.orchestrator.matrix.validate` | Request/Reply | Valida compatibilidade |

### 3.2 Contrato: Matrix Query

**Subject:** `mcp.orchestrator.matrix.query`

**Request:**
```json
{
  "query_type": "compatibility",
  "components": {
    "sdk": "mcp-ultra-sdk-custom@v9.0.0",
    "template": "mcp-ultra-template@2.0.0",
    "seed": "seed-waba@1.0.0"
  },
  "timestamp": "2025-10-05T21:10:00Z"
}
```

**Response:**
```json
{
  "query_id": "matrix-query-20251005-211000",
  "compatible": true,
  "compatibility_level": "FULL",
  "matrix_version": "1.5.0",
  "compatibility_details": {
    "sdk_to_template": {
      "compatible": true,
      "confidence": 100,
      "required_version": ">=2.0.0",
      "actual_version": "2.0.0",
      "status": "EXACT_MATCH"
    },
    "template_to_seed": {
      "compatible": true,
      "confidence": 100,
      "required_version": ">=1.0.0",
      "actual_version": "1.0.0",
      "status": "EXACT_MATCH"
    },
    "seed_to_sdk": {
      "compatible": true,
      "confidence": 100,
      "required_version": ">=v9.0.0",
      "actual_version": "v9.0.0",
      "status": "EXACT_MATCH"
    }
  },
  "warnings": [],
  "timestamp": "2025-10-05T21:10:01Z"
}
```

### 3.3 Contrato: Compatibility Validation

**Subject:** `mcp.orchestrator.matrix.validate`

**Request:**
```json
{
  "validation_type": "pre_deployment",
  "target_environment": "production",
  "components": {
    "sdk": {
      "name": "mcp-ultra-sdk-custom",
      "version": "v9.0.0",
      "contracts_version": "1.0.0"
    },
    "seeds": [
      {
        "name": "waba",
        "version": "1.0.0",
        "sdk_dependency": "v9.0.0"
      }
    ]
  },
  "timestamp": "2025-10-05T21:10:00Z"
}
```

**Response:**
```json
{
  "validation_id": "val-20251005-211000",
  "approved": true,
  "compatibility_status": "APPROVED",
  "validation_results": {
    "contract_compatibility": "PASS",
    "version_compatibility": "PASS",
    "feature_compatibility": "PASS",
    "breaking_changes": "NONE"
  },
  "deployment_safe": true,
  "rollback_plan": {
    "available": true,
    "previous_stable": "v8.0.0"
  },
  "timestamp": "2025-10-05T21:10:02Z"
}
```

### 3.4 MCP-Version-Matrix Schema

**Arquivo:** `docs/mcp-version-matrix.schema.json`

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "MCP Version Matrix",
  "description": "Matriz de compatibilidade vertical do ecossistema Vertikon Ultra",
  "type": "object",
  "properties": {
    "matrix_version": {
      "type": "string",
      "description": "Vers√£o da matriz (SemVer)"
    },
    "last_updated": {
      "type": "string",
      "format": "date-time"
    },
    "components": {
      "type": "object",
      "properties": {
        "sdk": {
          "type": "object",
          "properties": {
            "name": { "type": "string" },
            "versions": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "version": { "type": "string" },
                  "release_date": { "type": "string", "format": "date" },
                  "status": { "enum": ["stable", "deprecated", "eol"] },
                  "compatible_with": {
                    "type": "object",
                    "properties": {
                      "templates": { "type": "array", "items": { "type": "string" } },
                      "seeds": { "type": "array", "items": { "type": "string" } }
                    }
                  },
                  "breaking_changes": { "type": "array", "items": { "type": "string" } }
                },
                "required": ["version", "status", "compatible_with"]
              }
            }
          }
        },
        "templates": { "type": "object" },
        "seeds": { "type": "object" }
      }
    },
    "compatibility_rules": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "rule_id": { "type": "string" },
          "description": { "type": "string" },
          "from": { "type": "string" },
          "to": { "type": "string" },
          "version_constraint": { "type": "string" },
          "severity": { "enum": ["error", "warning", "info"] }
        }
      }
    }
  },
  "required": ["matrix_version", "components", "compatibility_rules"]
}
```

### 3.5 Exemplo de Version Matrix

**Arquivo:** `docs/mcp-version-matrix.example.json`

```json
{
  "matrix_version": "1.5.0",
  "last_updated": "2025-10-05T21:10:00Z",
  "components": {
    "sdk": {
      "name": "mcp-ultra-sdk-custom",
      "versions": [
        {
          "version": "v9.0.0",
          "release_date": "2025-10-05",
          "status": "stable",
          "contracts_version": "1.0.0",
          "compatible_with": {
            "templates": ["mcp-ultra-template@>=2.0.0"],
            "seeds": ["seed-waba@>=1.0.0", "seed-marketing@>=1.0.0"]
          },
          "breaking_changes": [],
          "certification": "VTK-SDK-CUSTOM-V9-20251005-STABLE"
        },
        {
          "version": "v8.0.0",
          "release_date": "2025-10-05",
          "status": "deprecated",
          "contracts_version": "1.0.0",
          "compatible_with": {
            "templates": ["mcp-ultra-template@>=2.0.0"],
            "seeds": ["seed-waba@>=1.0.0"]
          },
          "breaking_changes": [],
          "deprecation_date": "2025-10-05",
          "eol_date": "2026-01-05"
        }
      ]
    },
    "templates": {
      "name": "mcp-ultra-template",
      "versions": [
        {
          "version": "2.0.0",
          "release_date": "2025-09-01",
          "status": "stable",
          "compatible_with": {
            "sdks": ["mcp-ultra-sdk-custom@>=v8.0.0"],
            "seeds": ["seed-*@>=1.0.0"]
          }
        }
      ]
    },
    "seeds": {
      "waba": {
        "versions": [
          {
            "version": "1.0.0",
            "release_date": "2025-10-05",
            "status": "stable",
            "compatible_with": {
              "sdks": ["mcp-ultra-sdk-custom@>=v9.0.0"],
              "templates": ["mcp-ultra-template@>=2.0.0"]
            }
          }
        ]
      }
    }
  },
  "compatibility_rules": [
    {
      "rule_id": "SDK_TO_TEMPLATE_001",
      "description": "SDK major version must not exceed template major version + 1",
      "from": "sdk",
      "to": "template",
      "version_constraint": "sdk.major <= template.major + 1",
      "severity": "error"
    },
    {
      "rule_id": "SEED_TO_SDK_001",
      "description": "Seed contracts version must match SDK contracts version",
      "from": "seed",
      "to": "sdk",
      "version_constraint": "seed.contracts_version == sdk.contracts_version",
      "severity": "error"
    },
    {
      "rule_id": "DEPRECATED_WARNING_001",
      "description": "Warn when using deprecated SDK version",
      "from": "sdk",
      "to": "sdk",
      "version_constraint": "sdk.status != 'deprecated'",
      "severity": "warning"
    }
  ]
}
```

### 3.6 Implementa√ß√£o no SDK (Preparada)

**Arquivo:** `pkg/orchestrator/matrix.go` (a ser criado)

```go
package orchestrator

import (
    "context"
    "encoding/json"
    "time"

    "github.com/nats-io/nats.go"
)

// MatrixQuery representa uma consulta √† matriz de compatibilidade
type MatrixQuery struct {
    QueryType  string              `json:"query_type"`
    Components map[string]string   `json:"components"`
    Timestamp  time.Time           `json:"timestamp"`
}

// MatrixResponse representa a resposta da matriz
type MatrixResponse struct {
    QueryID              string                 `json:"query_id"`
    Compatible           bool                   `json:"compatible"`
    CompatibilityLevel   string                 `json:"compatibility_level"`
    MatrixVersion        string                 `json:"matrix_version"`
    CompatibilityDetails map[string]interface{} `json:"compatibility_details"`
    Warnings             []string               `json:"warnings"`
    Timestamp            time.Time              `json:"timestamp"`
}

// MatrixManager gerencia intera√ß√µes com a matriz de compatibilidade
type MatrixManager struct {
    nc         *nats.Conn
    sdkVersion string
    module     string
}

// NewMatrixManager cria um novo gerenciador de matriz
func NewMatrixManager(nc *nats.Conn, sdkVersion, module string) *MatrixManager {
    return &MatrixManager{
        nc:         nc,
        sdkVersion: sdkVersion,
        module:     module,
    }
}

// QueryCompatibility consulta compatibilidade na matriz
func (mm *MatrixManager) QueryCompatibility(ctx context.Context, components map[string]string) (*MatrixResponse, error) {
    query := MatrixQuery{
        QueryType:  "compatibility",
        Components: components,
        Timestamp:  time.Now(),
    }

    queryData, err := json.Marshal(query)
    if err != nil {
        return nil, err
    }

    msg, err := mm.nc.RequestWithContext(ctx, "mcp.orchestrator.matrix.query", queryData)
    if err != nil {
        return nil, err
    }

    var resp MatrixResponse
    if err := json.Unmarshal(msg.Data, &resp); err != nil {
        return nil, err
    }

    return &resp, nil
}

// ValidateDeployment valida compatibilidade antes de deploy
func (mm *MatrixManager) ValidateDeployment(ctx context.Context, components map[string]interface{}) (*ValidationResponse, error) {
    req := ValidationRequest{
        ValidationType:    "pre_deployment",
        TargetEnvironment: "production",
        Components:        components,
        Timestamp:         time.Now(),
    }

    reqData, err := json.Marshal(req)
    if err != nil {
        return nil, err
    }

    msg, err := mm.nc.RequestWithContext(ctx, "mcp.orchestrator.matrix.validate", reqData)
    if err != nil {
        return nil, err
    }

    var resp ValidationResponse
    if err := json.Unmarshal(msg.Data, &resp); err != nil {
        return nil, err
    }

    return &resp, nil
}
```

---

## üì¶ 4. Metadados do SDK para Orquestrador

### 4.1 SDK Metadata File

**Arquivo:** `sdk-metadata.json` (a ser criado na raiz do projeto)

```json
{
  "sdk": {
    "name": "mcp-ultra-sdk-custom",
    "version": "v9.0.0",
    "module": "github.com/vertikon/mcp-ultra-sdk-custom",
    "contracts_version": "1.0.0",
    "release_date": "2025-10-05",
    "status": "stable",
    "certification": {
      "id": "VTK-SDK-CUSTOM-V9-20251005-STABLE",
      "score": 100,
      "validator_version": "4.2.1",
      "date": "2025-10-05T21:05:00Z",
      "valid_until": "2026-10-05T23:59:59Z"
    }
  },
  "capabilities": {
    "plugins": true,
    "middlewares": true,
    "jobs": true,
    "services": true,
    "nats_integration": true,
    "health_checks": true,
    "metrics": true,
    "structured_logs": true
  },
  "orchestrator_integration": {
    "sync_enabled": true,
    "audit_enabled": true,
    "matrix_enabled": true,
    "subjects": [
      "mcp.orchestrator.sync.request",
      "mcp.orchestrator.sync.seed.*",
      "mcp.orchestrator.audit.version.request",
      "mcp.orchestrator.matrix.query",
      "mcp.orchestrator.matrix.validate"
    ]
  },
  "dependencies": {
    "required": {
      "go": ">=1.23",
      "gorilla/mux": "v1.8.1",
      "prometheus/client_golang": "v1.19.0"
    },
    "optional": {
      "nats-io/nats.go": ">=1.31.0"
    }
  },
  "compatible_with": {
    "templates": ["mcp-ultra-template@>=2.0.0"],
    "seeds": ["seed-*@>=1.0.0"],
    "orchestrator": ["mcp-ultra-orquestrador@>=1.0.0"]
  }
}
```

---

## üîß 5. Configura√ß√£o para Integra√ß√£o

### 5.1 Environment Variables

```bash
# Orquestrador Connection
MCP_ORCHESTRATOR_ENABLED=true
MCP_ORCHESTRATOR_NATS_URL=nats://orchestrator.vertikon.internal:4222
MCP_ORCHESTRATOR_CLUSTER_ID=mcp-ultra-cluster
MCP_ORCHESTRATOR_CLIENT_ID=sdk-custom-v9

# Sync Configuration
MCP_SYNC_AUTO_ENABLED=true
MCP_SYNC_INTERVAL=3600  # 1 hora
MCP_SYNC_SEEDS=waba,marketing

# Audit Configuration
MCP_AUDIT_AUTO_ENABLED=true
MCP_AUDIT_ON_STARTUP=true
MCP_AUDIT_PERIODIC=true
MCP_AUDIT_INTERVAL=86400  # 24 horas

# Matrix Configuration
MCP_MATRIX_VALIDATION_ENABLED=true
MCP_MATRIX_STRICT_MODE=true
MCP_MATRIX_CACHE_TTL=3600
```

### 5.2 Configuration File

**Arquivo:** `config/orchestrator.yaml`

```yaml
orchestrator:
  enabled: true
  connection:
    nats_url: nats://orchestrator.vertikon.internal:4222
    cluster_id: mcp-ultra-cluster
    client_id: sdk-custom-v9
    max_reconnects: 10
    reconnect_wait: 2s

  sync:
    auto_enabled: true
    interval: 1h
    seeds:
      - waba
      - marketing
    on_update:
      action: notify  # notify, auto-apply, manual
      restart_required: false

  audit:
    auto_enabled: true
    on_startup: true
    periodic: true
    interval: 24h
    alert_on_incompatibility: true
    slack_webhook: https://hooks.slack.com/services/xxx

  matrix:
    validation_enabled: true
    strict_mode: true  # Bloqueia deploy se incompat√≠vel
    cache_ttl: 1h
    rules:
      - sdk_to_template_version_check
      - seed_to_sdk_contracts_check
      - deprecated_version_warning
```

---

## üìã 6. Checklist de Prepara√ß√£o

### SDK Pronto para Integra√ß√£o ‚úÖ

- [x] Contratos NATS documentados
- [x] Subjects definidos
- [x] Esquemas de mensagens especificados
- [x] Metadados do SDK criados
- [x] Documenta√ß√£o de integra√ß√£o completa
- [x] Configura√ß√µes de exemplo fornecidas

### Aguardando Orquestrador ‚è≥

- [ ] Implementar `pkg/orchestrator/sync.go`
- [ ] Implementar `pkg/orchestrator/audit.go`
- [ ] Implementar `pkg/orchestrator/matrix.go`
- [ ] Criar `sdk-metadata.json`
- [ ] Criar `config/orchestrator.yaml`
- [ ] Adicionar testes de integra√ß√£o
- [ ] Atualizar README com se√ß√£o de orquestra√ß√£o

---

## üöÄ 7. Quando o Orquestrador Estiver Pronto

### Passo 1: Instalar Depend√™ncia NATS

```bash
go get github.com/nats-io/nats.go@latest
```

### Passo 2: Criar Implementa√ß√µes

```bash
# Criar package orchestrator
mkdir -p pkg/orchestrator

# Criar arquivos de implementa√ß√£o
touch pkg/orchestrator/sync.go
touch pkg/orchestrator/audit.go
touch pkg/orchestrator/matrix.go
touch pkg/orchestrator/types.go
```

### Passo 3: Atualizar Bootstrap

**Arquivo:** `pkg/bootstrap/bootstrap.go`

```go
// Adicionar ao Config
type Config struct {
    // ... existing fields
    OrchestratorEnabled bool
    OrchestratorNATSURL string
}

// Adicionar ao Bootstrap
func Bootstrap(cfg Config) *mux.Router {
    // ... existing code

    if cfg.OrchestratorEnabled {
        nc, err := nats.Connect(cfg.OrchestratorNATSURL)
        if err != nil {
            log.Fatal("Failed to connect to orchestrator:", err)
        }

        // Initialize managers
        syncMgr := orchestrator.NewSyncManager(nc, "v9.0.0", "github.com/vertikon/mcp-ultra-sdk-custom")
        auditMgr := orchestrator.NewAuditManager(nc, "v9.0.0", "github.com/vertikon/mcp-ultra-sdk-custom")
        matrixMgr := orchestrator.NewMatrixManager(nc, "v9.0.0", "github.com/vertikon/mcp-ultra-sdk-custom")

        // Start background sync/audit
        go runPeriodicSync(syncMgr)
        go runPeriodicAudit(auditMgr)
    }

    return mux
}
```

### Passo 4: Testes de Integra√ß√£o

```bash
# Criar testes
touch pkg/orchestrator/sync_test.go
touch pkg/orchestrator/audit_test.go
touch pkg/orchestrator/matrix_test.go
```

### Passo 5: Valida√ß√£o Final

```bash
# Compilar
go build ./cmd

# Testar
go test ./pkg/orchestrator/...

# Validar
cd E:\vertikon\.ecosistema-vertikon\mcp-tester-system
go run enhanced_validator_v4.go E:\vertikon\business\SaaS\templates\mcp-ultra-sdk-custom
```

---

## üìä 8. Diagrama de Sequ√™ncia (Sync Flow)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  SDK   ‚îÇ         ‚îÇ Orquestrador ‚îÇ         ‚îÇ NATS Server ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ                     ‚îÇ                        ‚îÇ
    ‚îÇ 1. RequestSync()    ‚îÇ                        ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                        ‚îÇ
    ‚îÇ                     ‚îÇ                        ‚îÇ
    ‚îÇ                     ‚îÇ 2. Check Version Matrix‚îÇ
    ‚îÇ                     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
    ‚îÇ                     ‚îÇ                        ‚îÇ
    ‚îÇ                     ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    ‚îÇ                     ‚îÇ 3. Matrix Response     ‚îÇ
    ‚îÇ                     ‚îÇ                        ‚îÇ
    ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                        ‚îÇ
    ‚îÇ 4. Sync Response    ‚îÇ                        ‚îÇ
    ‚îÇ                     ‚îÇ                        ‚îÇ
    ‚îÇ 5. Subscribe Seed Updates                    ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
    ‚îÇ                     ‚îÇ                        ‚îÇ
    ‚îÇ                     ‚îÇ 6. Seed Update Available
    ‚îÇ                     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
    ‚îÇ                     ‚îÇ                        ‚îÇ
    ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    ‚îÇ 7. Seed Update Notification                  ‚îÇ
    ‚îÇ                     ‚îÇ                        ‚îÇ
    ‚îÇ 8. Download & Apply ‚îÇ                        ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                        ‚îÇ
    ‚îÇ                     ‚îÇ                        ‚îÇ
    ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                        ‚îÇ
    ‚îÇ 9. Update Confirmed ‚îÇ                        ‚îÇ
    ‚îÇ                     ‚îÇ                        ‚îÇ
```

---

## üìû Pr√≥ximos Passos

1. **Aguardar release do MCP-ULTRA-ORQUESTRADOR**
2. **Quando pronto:**
   - Implementar os 3 arquivos Go (`sync.go`, `audit.go`, `matrix.go`)
   - Criar `sdk-metadata.json`
   - Criar `config/orchestrator.yaml`
   - Adicionar testes de integra√ß√£o
   - Atualizar documenta√ß√£o
   - Executar valida√ß√£o final

3. **Testar integra√ß√£o:**
   - Sync autom√°tico de seeds
   - Auditoria de vers√µes
   - Valida√ß√£o via matriz

---

## ‚úÖ Resumo

**Status Atual:**
- ‚úÖ Especifica√ß√£o completa
- ‚úÖ Contratos NATS definidos
- ‚úÖ Esquemas de mensagens documentados
- ‚úÖ C√≥digo de exemplo preparado
- ‚úÖ Configura√ß√µes exemplificadas
- ‚úÖ Documenta√ß√£o completa

**Pr√≥xima A√ß√£o:**
- ‚è≥ Aguardar MCP-ULTRA-ORQUESTRADOR v1.0.0
- ‚è≥ Implementar integra√ß√µes quando dispon√≠vel

---

**Vers√£o do Documento:** 1.0.0
**√öltima Atualiza√ß√£o:** 2025-10-05
**Autor:** Claude Sonnet 4.5 (Autonomous Mode)
**Status:** üìã ESPECIFICA√á√ÉO COMPLETA
